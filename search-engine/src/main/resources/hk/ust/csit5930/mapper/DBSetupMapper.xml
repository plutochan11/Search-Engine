<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "hk.ust.csit5930.mapper.DBSetupMapper">
    <insert id="createPagesTable">
        DROP TABLE IF EXISTS relationships;
        DROP TABLE IF EXISTS pages;
        CREATE TABLE IF NOT EXISTS pages (
            id INT PRIMARY KEY AUTO_INCREMENT,
            url VARCHAR(255) UNIQUE NOT NULL,
            title VARCHAR(255),
            content CLOB,
            last_modified TIMESTAMP,
            size INT
        );
        CREATE INDEX idx_url ON pages (url);
    </insert>

    <insert id="createRelationshipsTable">
        CREATE TABLE IF NOT EXISTS relationships (
            id INT AUTO_INCREMENT,
            parent_url VARCHAR(255) NOT NULL,
            child_url VARCHAR(255) NOT NULL,
            PRIMARY KEY (id),
            FOREIGN KEY (parent_url) REFERENCES pages (url) ON DELETE CASCADE
            <!-- FOREIGN KEY (child_url) REFERENCES pages (id) ON DELETE CASCADE -->
        );
        CREATE INDEX idx_parent ON relationships (parent_url);
        CREATE INDEX idx_child ON relationships (child_url);
    </insert>
</mapper>